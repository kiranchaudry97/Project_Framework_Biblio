@page
@model Biblio_Web.Areas.Identity.Pages.Account.LoginModel
@inject Microsoft.Extensions.Localization.IStringLocalizer<Biblio_Web.SharedResource> Localizer
@inject Microsoft.AspNetCore.Hosting.IWebHostEnvironment Env
@using System.Globalization
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="form-centered">
    <div class="text-center mb-3">
        <a class="navbar-brand fw-bold fs-4" asp-area="" asp-controller="Home" asp-action="Index">Biblio</a>
        <img src="~/images/login-illustration.svg" alt="Login illustration" class="img-fluid mt-3 mb-2" style="max-width:90px; width:90px; height:auto; display:block; margin:0 auto;" />
    </div>

    @if (User?.Identity?.IsAuthenticated == true)
    {
        <h1 class="h3 mb-3 fw-semibold text-center">@($"{Localizer["Welcome"]} {User.Identity.Name}")</h1>
    }
    else
    {
        <h1 class="h3 mb-3 fw-semibold text-center">@Localizer["Welkom bij biblio!"]</h1>
        <h1 class="h3 mb-3 fw-semibold text-center">@Localizer["Welcome"]</h1>
    }

    <form method="post" class="needs-validation" novalidate>
        <partial name="_ValidationScriptsPartial" />

        <div asp-validation-summary="All" class="text-danger mb-2"></div>

        <div class="mx-auto" style="max-width:420px;">
            <div class="form-floating mb-3">
                <input asp-for="Input.Email" id="Input_Email" type="email" class="form-control form-control-sm"
                    maxlength="254" />
                <label asp-for="Input.Email">@Localizer["Email"]</label>
                <span asp-validation-for="Input.Email" class="text-danger small"></span>
            </div>

            <div class="form-floating mb-3">
                <input asp-for="Input.Password" id="Input_Password" type="password" class="form-control form-control-sm"
                    maxlength="100" />
                <label asp-for="Input.Password">@Localizer["Password"]</label>
                <span asp-validation-for="Input.Password" class="text-danger small"></span>
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="showPassword" />
                <label class="form-check-label" for="showPassword">@Localizer["Show Password"]</label>
            </div>

            <div class="form-check mb-3">
                <input asp-for="Input.RememberMe" class="form-check-input" />
                <label asp-for="Input.RememberMe" class="form-check-label">@Localizer["Remember Me"]</label>
            </div>

            @* Development-only test accounts quick-fill: only autofill emails. Passwords should not be stored in repo; set via user-secrets. *@
            @if (Env.IsDevelopment())
            {
                <div class="alert alert-secondary small mb-3">
                    <strong>Test accounts:</strong>
                    <div class="mt-2">
                        <button type="button" class="btn btn-sm btn-outline-primary me-2" onclick="fillTest('admin')">Autofill admin</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="fillTest('medewerker')">Autofill medewerker</button>
                        <small class="d-block text-muted mt-2">Admin: <code>admin@biblio.local</code> — Medewerker: <code>medewerker@biblio.local</code></small>

                        <div class="mt-2">
                            <small class="text-muted">Set development passwords with user-secrets (do not commit):</small>
                            <pre class="small bg-light p-2">dotnet user-secrets set "Seed:AdminPassword" "&lt;your-admin-password&gt;" --project Biblio_Web\Biblio_Web.csproj
dotnet user-secrets set "Seed:MedewerkerPassword" "&lt;your-medewerker-password&gt;" --project Biblio_Web\Biblio_Web.csproj</pre>
                        </div>

                        <div class="mt-2">
                            <small class="text-dark">Voor testdoeleinden (development only):</small>
                            <div class="small mt-1">
                                <code>Admin — email: admin@biblio.local | wachtwoord: Admin1234?</code><br />
                                <code>Medewerker — email: medewerker@biblio.local | wachtwoord: test1234?</code>
                            </div>
                        </div>
                    </div>
                </div>
            }

            <button type="submit" class="btn btn-primary btn-sm mx-auto d-block mb-2" style="min-width:140px;">@Localizer["Login"]</button>

            <div class="text-center small mt-2">
                <a asp-page="./Register" class="mx-2">@Localizer["Register Link"]</a>
                <a asp-page="./ForgotPassword" class="mx-2">@Localizer["Forgot Password Link"]</a>
            </div>
        </div>

    </form>

</div>

@section Scripts {
    <script>
        (function() {
            var cb = document.getElementById('showPassword');
            var pw = document.getElementById('Input_Password');
            if (cb && pw) cb.addEventListener('change', function() { pw.type = this.checked ? 'text' : 'password'; });

            // culture select removed from this page because it's available in the site navigation
        })();

        // Helper to autofill test accounts in development (emails only)
        function fillTest(kind) {
            try {
                var email = document.getElementById('Input_Email');
                var pw = document.getElementById('Input_Password');
                if (!email || !pw) return;

                if (kind === 'admin') {
                    email.value = 'admin@biblio.local';
                    pw.value = 'Admin1234?';
                } else if (kind === 'medewerker') {
                    email.value = 'medewerker@biblio.local';
                    pw.value = 'test1234?';
                }
            } catch (e) {
                console.warn('fillTest error', e);
            }
        }
    </script>
}