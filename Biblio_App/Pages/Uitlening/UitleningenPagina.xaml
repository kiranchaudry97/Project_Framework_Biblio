<?xml version="1.0" encoding="utf-8" ?>
<?xaml-comp compile="true" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:Biblio_App.ViewModels"
             xmlns:models="clr-namespace:Biblio_Models.Entiteiten;assembly=Biblio_Models"
             xmlns:converters="clr-namespace:Biblio_App.Converters"
             xmlns:local="clr-namespace:Biblio_App.Pages"
             x:Class="Biblio_App.Pages.UitleningenPagina"
             x:Name="PageRoot"
             x:DataType="viewmodel:UitleningenViewModel"
             Title="{Binding PageHeaderText}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Lokale fallback zodat StaticResource resolveert tijdens compilatie -->
            <Color x:Key="Gray700">#5A5A5A</Color>
            <SolidColorBrush x:Key="Gray700Brush" Color="{StaticResource Gray700}" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Shell.TitleView>
        <Grid ColumnDefinitions="*,Auto" Padding="0,0,8,0" VerticalOptions="Center" BackgroundColor="{StaticResource Primary}">
            <!-- genaamd TitleLabel zodat code-behind de weergegeven titel geforceerd kan updaten wanneer de taal wijzigt -->
            <Label x:Name="TitleLabel" Text="{Binding PageHeaderText}" FontSize="22" FontAttributes="Bold" VerticalOptions="Center" TextColor="White" Grid.Column="0" />
            <Label x:Name="PageLanguageLabel"
                   Grid.Column="1"
                   WidthRequest="48"
                   Margin="0,0,12,0"
                   VerticalOptions="Center"
                   HorizontalOptions="End"
                   TextColor="{StaticResource White}"
                   BackgroundColor="Transparent"
                   HorizontalTextAlignment="End" />
        </Grid>
    </Shell.TitleView>

    <!-- Grid-layout voor consistente cross-platform weergave met scrollende lijst -->
    <Grid x:Name="MainGrid" BackgroundColor="White">
        <Grid.Padding>
            <OnPlatform x:TypeArguments="Thickness">
                <On Platform="Android" Value="8" />
                <On Platform="iOS" Value="8" />
                <On Platform="WinUI" Value="12" />
            </OnPlatform>
        </Grid.Padding>
        <Grid.RowDefinitions>
            <!-- header + stats -->
            <RowDefinition Height="Auto" />
            <!-- filterkaart + formulier + lijst in ScrollView -->
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <VerticalStackLayout Grid.Row="0" BackgroundColor="White">
            <VerticalStackLayout.Spacing>
                <OnPlatform x:TypeArguments="x:Double">
                    <On Platform="Android" Value="8" />
                    <On Platform="iOS" Value="8" />
                    <On Platform="WinUI" Value="12" />
                </OnPlatform>
            </VerticalStackLayout.Spacing>
            
            <Label Text="{Binding PageHeaderText}" Style="{StaticResource PageHeaderLabel}" TextColor="#212121">
                <Label.FontSize>
                    <OnPlatform x:TypeArguments="x:Double">
                        <On Platform="Android" Value="18" />
                        <On Platform="iOS" Value="18" />
                        <On Platform="WinUI" Value="20" />
                    </OnPlatform>
                </Label.FontSize>
                <Label.Margin>
                    <OnPlatform x:TypeArguments="Thickness">
                        <On Platform="Android" Value="0,6,0,6" />
                        <On Platform="iOS" Value="0,6,0,6" />
                        <On Platform="WinUI" Value="0,8,0,8" />
                    </OnPlatform>
                </Label.Margin>
            </Label>

            <!-- Status / aantallen met navy blue achtergrond zoals design - compacter op mobile -->
            <Frame Style="{StaticResource UitleningenHeader}">
                <Frame.Padding>
                    <OnPlatform x:TypeArguments="Thickness">
                        <On Platform="Android" Value="10,6" />
                        <On Platform="iOS" Value="10,6" />
                        <On Platform="WinUI" Value="12,8" />
                    </OnPlatform>
                </Frame.Padding>
                <HorizontalStackLayout HorizontalOptions="Center">
                    <HorizontalStackLayout.Spacing>
                        <OnPlatform x:TypeArguments="x:Double">
                            <On Platform="Android" Value="8" />
                            <On Platform="iOS" Value="8" />
                            <On Platform="WinUI" Value="12" />
                        </OnPlatform>
                    </HorizontalStackLayout.Spacing>
                    
                    <Label Text="{Binding MembersLabel}" Style="{StaticResource StatLabel}">
                        <Label.FontSize>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="Android" Value="12" />
                                <On Platform="iOS" Value="12" />
                                <On Platform="WinUI" Value="13" />
                            </OnPlatform>
                        </Label.FontSize>
                    </Label>
                    <Label Text="{Binding LedenCount}" FontAttributes="Bold" TextColor="White">
                        <Label.FontSize>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="Android" Value="13" />
                                <On Platform="iOS" Value="13" />
                                <On Platform="WinUI" Value="14" />
                            </OnPlatform>
                        </Label.FontSize>
                    </Label>
                    <Label Text="{Binding LoansLabel}" Style="{StaticResource StatLabel}">
                        <Label.FontSize>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="Android" Value="12" />
                                <On Platform="iOS" Value="12" />
                                <On Platform="WinUI" Value="13" />
                            </OnPlatform>
                        </Label.FontSize>
                    </Label>
                    <Label Text="{Binding UitleningenCount}" FontAttributes="Bold" TextColor="White">
                        <Label.FontSize>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="Android" Value="13" />
                                <On Platform="iOS" Value="13" />
                                <On Platform="WinUI" Value="14" />
                            </OnPlatform>
                        </Label.FontSize>
                    </Label>
                    <Label Text="{Binding BooksLabel}" Style="{StaticResource StatLabel}">
                        <Label.FontSize>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="Android" Value="12" />
                                <On Platform="iOS" Value="12" />
                                <On Platform="WinUI" Value="13" />
                            </OnPlatform>
                        </Label.FontSize>
                    </Label>
                    <Label Text="{Binding BoekenCount}" FontAttributes="Bold" TextColor="White">
                        <Label.FontSize>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="Android" Value="13" />
                                <On Platform="iOS" Value="13" />
                                <On Platform="WinUI" Value="14" />
                            </OnPlatform>
                        </Label.FontSize>
                    </Label>
                </HorizontalStackLayout>
            </Frame>

            <!-- DB pad weergave en kopieer knop -->
            <!--<HorizontalStackLayout Spacing="8" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                <Label Text="{Binding DbPathLabelText}" VerticalOptions="Center" TextColor="{StaticResource White}" />
                <Label x:Name="DbPathLabel" Text="{Binding DbPathNotLoadedText}" LineBreakMode="TailTruncation" HorizontalOptions="FillAndExpand" VerticalOptions="Center" TextColor="{StaticResource White}" />
                <Button Text="{Binding CopyPathButtonText}" Clicked="OnCopyDbPathClicked" />
            </HorizontalStackLayout>-->

            <Label Text="{Binding LastError}" TextColor="Crimson" HorizontalOptions="Center" IsVisible="{Binding LastError, Converter={StaticResource StringNotEmptyToBoolConverter}}" />
        </VerticalStackLayout>

        <!-- Scrollend gedeelte met filters, lijst en formulier -->
        <ScrollView x:Name="MainScroll" Grid.Row="1" BackgroundColor="White">
            <VerticalStackLayout BackgroundColor="White">
                <VerticalStackLayout.Spacing>
                    <OnPlatform x:TypeArguments="x:Double">
                        <On Platform="Android" Value="8" />
                        <On Platform="iOS" Value="8" />
                        <On Platform="WinUI" Value="12" />
                    </OnPlatform>
                </VerticalStackLayout.Spacing>

                <Frame Style="{StaticResource WelcomeCardStyle}" BackgroundColor="White">
                    <Frame.Padding>
                        <OnPlatform x:TypeArguments="Thickness">
                            <On Platform="Android" Value="10" />
                            <On Platform="iOS" Value="10" />
                            <On Platform="WinUI" Value="12" />
                        </OnPlatform>
                    </Frame.Padding>
                    <VerticalStackLayout>
                    <VerticalStackLayout.Spacing>
                        <OnPlatform x:TypeArguments="x:Double">
                            <On Platform="Android" Value="8" />
                            <On Platform="iOS" Value="8" />
                            <On Platform="WinUI" Value="12" />
                        </OnPlatform>
                    </VerticalStackLayout.Spacing>
                    
                    <!-- Filters met styled components - compacter op mobile -->
                    <VerticalStackLayout>
                        <VerticalStackLayout.Spacing>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="Android" Value="6" />
                                <On Platform="iOS" Value="6" />
                                <On Platform="WinUI" Value="8" />
                            </OnPlatform>
                        </VerticalStackLayout.Spacing>
                        
                        <Entry Placeholder="Zoek op titel, auteur of ISBN" 
                               Text="{Binding SearchText}" 
                               Style="{StaticResource SearchEntry}"
                               BackgroundColor="#F5F5F5">
                            <Entry.HeightRequest>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="42" />
                                    <On Platform="iOS" Value="42" />
                                    <On Platform="WinUI" Value="50" />
                                </OnPlatform>
                            </Entry.HeightRequest>
                            <Entry.FontSize>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="14" />
                                    <On Platform="iOS" Value="14" />
                                    <On Platform="WinUI" Value="16" />
                                </OnPlatform>
                            </Entry.FontSize>
                        </Entry>
                        <Button Text="{Binding FilterButtonText}" 
                                Command="{Binding ZoekCommand}" 
                                Style="{StaticResource FilterButton}"
                                HorizontalOptions="FillAndExpand">
                            <Button.HeightRequest>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="38" />
                                    <On Platform="iOS" Value="38" />
                                    <On Platform="WinUI" Value="45" />
                                </OnPlatform>
                            </Button.HeightRequest>
                        </Button>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <VerticalStackLayout.Spacing>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="Android" Value="6" />
                                <On Platform="iOS" Value="6" />
                                <On Platform="WinUI" Value="8" />
                            </OnPlatform>
                        </VerticalStackLayout.Spacing>
                        
                        <Grid ColumnDefinitions="Auto,*" Margin="0,8,0,0">
                            <Label Grid.Column="0"
                                   Text="Filter op lid"
                                   FontSize="14"
                                   TextColor="#757575"
                                   VerticalOptions="Center"
                                   MinimumWidthRequest="90"
                                   Padding="0,0,8,0" />
                            <Picker Grid.Column="1"
                                    ItemsSource="{Binding LedenList}"
                                    ItemDisplayBinding="{Binding FullName}"
                                    SelectedItem="{Binding FilterLid, Mode=TwoWay}"
                                    Title="Filter op lid"
                                    BackgroundColor="#F5F5F5"
                                    TextColor="#212121"
                                    TitleColor="#6E6E6E"
                                    HorizontalOptions="FillAndExpand"
                                    HorizontalTextAlignment="Start"
                                    IsVisible="True"
                                    MinimumHeightRequest="44"
                                    HeightRequest="44"
                                    Margin="0,4">
                                <Picker.FontSize>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="14" />
                                        <On Platform="iOS" Value="14" />
                                        <On Platform="WinUI" Value="18" />
                                    </OnPlatform>
                                </Picker.FontSize>
                            </Picker>
                        </Grid>
                        <Grid ColumnDefinitions="Auto,*" Margin="0,8,0,0">
                            <Label Grid.Column="0"
                                   Text="Filter op boek"
                                   FontSize="14"
                                   TextColor="#757575"
                                   VerticalOptions="Center"
                                   MinimumWidthRequest="90"
                                   Padding="0,0,8,0" />
                            <Picker Grid.Column="1"
                                    ItemsSource="{Binding BoekenList}"
                                    ItemDisplayBinding="{Binding Titel}"
                                    SelectedItem="{Binding FilterBoek, Mode=TwoWay}"
                                    Title="Filter op boek"
                                    BackgroundColor="#F5F5F5"
                                    TextColor="#212121"
                                    TitleColor="#6E6E6E"
                                    HorizontalOptions="FillAndExpand"
                                    HorizontalTextAlignment="Start"
                                    IsVisible="True"
                                    MinimumHeightRequest="44"
                                    HeightRequest="44"
                                    Margin="0,4">
                                <Picker.FontSize>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="14" />
                                        <On Platform="iOS" Value="14" />
                                        <On Platform="WinUI" Value="18" />
                                    </OnPlatform>
                                </Picker.FontSize>
                            </Picker>
                        </Grid>
                    </VerticalStackLayout>

                    <!-- Lijst van uitleningen met item kaart die overeenkomt met screenshot - compacter op mobile -->
                    <CollectionView ItemsSource="{Binding Uitleningen}" 
                                    SelectionMode="Single" 
                                    SelectedItem="{Binding SelectedUitlening, Mode=TwoWay}">
                        <CollectionView.MinimumHeightRequest>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="Android" Value="180" />
                                <On Platform="iOS" Value="180" />
                                <On Platform="WinUI" Value="200" />
                            </OnPlatform>
                        </CollectionView.MinimumHeightRequest>
                        <CollectionView.MaximumHeightRequest>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="Android" Value="400" />
                                <On Platform="iOS" Value="400" />
                                <On Platform="WinUI" Value="450" />
                            </OnPlatform>
                        </CollectionView.MaximumHeightRequest>
                        <CollectionView.Margin>
                            <OnPlatform x:TypeArguments="Thickness">
                                <On Platform="Android" Value="0,6,0,6" />
                                <On Platform="iOS" Value="0,6,0,6" />
                                <On Platform="WinUI" Value="0,8,0,8" />
                            </OnPlatform>
                        </CollectionView.Margin>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Lenen">
                                <Border Stroke="{StaticResource Gray100}" 
                                        StrokeThickness="1" 
                                        Padding="0" 
                                        BackgroundColor="White" 
                                        StrokeShape="RoundRectangle 8">
                                    <Border.Margin>
                                        <OnPlatform x:TypeArguments="Thickness">
                                            <On Platform="Android" Value="0,4" />
                                            <On Platform="iOS" Value="0,4" />
                                            <On Platform="WinUI" Value="0,8" />
                                        </OnPlatform>
                                    </Border.Margin>
                                    <!-- Vereenvoudigde lay-out: alleen info -->
                                    <Grid ColumnDefinitions="*">
                                        <Grid.Padding>
                                            <OnPlatform x:TypeArguments="Thickness">
                                                <On Platform="Android" Value="10" />
                                                <On Platform="iOS" Value="10" />
                                                <On Platform="WinUI" Value="12" />
                                            </OnPlatform>
                                        </Grid.Padding>
                                        <!-- Lid en boek info -->
                                        <VerticalStackLayout Grid.Column="0" HorizontalOptions="FillAndExpand">
                                            <VerticalStackLayout.Spacing>
                                                <OnPlatform x:TypeArguments="x:Double">
                                                    <On Platform="Android" Value="6" />
                                                    <On Platform="iOS" Value="6" />
                                                    <On Platform="WinUI" Value="8" />
                                                </OnPlatform>
                                            </VerticalStackLayout.Spacing>
                                            <VerticalStackLayout.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnItemHeaderTapped" />
                                            </VerticalStackLayout.GestureRecognizers>
                                            
                                            <!-- Book Title - Most prominent -->
                                            <Label Text="{Binding Boek.Titel}" 
                                                   FontAttributes="Bold" 
                                                   TextColor="{StaticResource Primary}"
                                                   LineBreakMode="WordWrap">
                                                <Label.FontSize>
                                                    <OnPlatform x:TypeArguments="x:Double">
                                                        <On Platform="Android" Value="16" />
                                                        <On Platform="iOS" Value="16" />
                                                        <On Platform="WinUI" Value="17" />
                                                    </OnPlatform>
                                                </Label.FontSize>
                                            </Label>
                                            
                                            <!-- Lid Naam -->
                                            <HorizontalStackLayout>
                                                <HorizontalStackLayout.Spacing>
                                                    <OnPlatform x:TypeArguments="x:Double">
                                                        <On Platform="Android" Value="4" />
                                                        <On Platform="iOS" Value="4" />
                                                        <On Platform="WinUI" Value="6" />
                                                    </OnPlatform>
                                                </HorizontalStackLayout.Spacing>
                                                <Label Text="Lid:" TextColor="#6E6E6E" FontAttributes="Bold">
                                                    <Label.FontSize>
                                                        <OnPlatform x:TypeArguments="x:Double">
                                                            <On Platform="Android" Value="12" />
                                                            <On Platform="iOS" Value="12" />
                                                            <On Platform="WinUI" Value="13" />
                                                        </OnPlatform>
                                                    </Label.FontSize>
                                                </Label>
                                                <Label TextColor="#212121">
                                                    <Label.FontSize>
                                                        <OnPlatform x:TypeArguments="x:Double">
                                                            <On Platform="Android" Value="12" />
                                                            <On Platform="iOS" Value="12" />
                                                            <On Platform="WinUI" Value="13" />
                                                        </OnPlatform>
                                                    </Label.FontSize>
                                                    <Label.FormattedText>
                                                        <FormattedString>
                                                            <Span Text="{Binding Lid.Voornaam}" />
                                                            <Span Text=" " />
                                                            <Span Text="{Binding Lid.AchterNaam}" />
                                                        </FormattedString>
                                                    </Label.FormattedText>
                                                </Label>
                                            </HorizontalStackLayout>

                                            <!-- toon Start en Einddatums in het item -->
                                            <VerticalStackLayout>
                                                <VerticalStackLayout.Spacing>
                                                    <OnPlatform x:TypeArguments="x:Double">
                                                        <On Platform="Android" Value="4" />
                                                        <On Platform="iOS" Value="4" />
                                                        <On Platform="WinUI" Value="6" />
                                                    </OnPlatform>
                                                </VerticalStackLayout.Spacing>
                                                <HorizontalStackLayout>
                                                    <HorizontalStackLayout.Spacing>
                                                        <OnPlatform x:TypeArguments="x:Double">
                                                            <On Platform="Android" Value="4" />
                                                            <On Platform="iOS" Value="4" />
                                                            <On Platform="WinUI" Value="6" />
                                                        </OnPlatform>
                                                    </HorizontalStackLayout.Spacing>
                                                    <Label Text="Start:" 
                                                           TextColor="#6E6E6E" 
                                                           FontAttributes="Bold">
                                                        <Label.FontSize>
                                                            <OnPlatform x:TypeArguments="x:Double">
                                                                <On Platform="Android" Value="11" />
                                                                <On Platform="iOS" Value="11" />
                                                                <On Platform="WinUI" Value="12" />
                                                            </OnPlatform>
                                                        </Label.FontSize>
                                                    </Label>
                                                    <Label Text="{Binding StartDate, StringFormat='{0:dd-MM-yyyy}'}" 
                                                           TextColor="#212121">
                                                        <Label.FontSize>
                                                            <OnPlatform x:TypeArguments="x:Double">
                                                                <On Platform="Android" Value="11" />
                                                                <On Platform="iOS" Value="11" />
                                                                <On Platform="WinUI" Value="12" />
                                                            </OnPlatform>
                                                        </Label.FontSize>
                                                    </Label>
                                                </HorizontalStackLayout>
                                                
                                                <HorizontalStackLayout>
                                                    <HorizontalStackLayout.Spacing>
                                                        <OnPlatform x:TypeArguments="x:Double">
                                                            <On Platform="Android" Value="4" />
                                                            <On Platform="iOS" Value="4" />
                                                            <On Platform="WinUI" Value="6" />
                                                        </OnPlatform>
                                                    </HorizontalStackLayout.Spacing>
                                                    <Label Text="Tot:" 
                                                           TextColor="#6E6E6E" 
                                                           FontAttributes="Bold">
                                                        <Label.FontSize>
                                                            <OnPlatform x:TypeArguments="x:Double">
                                                                <On Platform="Android" Value="11" />
                                                                <On Platform="iOS" Value="11" />
                                                                <On Platform="WinUI" Value="12" />
                                                            </OnPlatform>
                                                        </Label.FontSize>
                                                    </Label>
                                                    <Label Text="{Binding DueDate, StringFormat='{0:dd-MM-yyyy}'}" 
                                                           TextColor="#212121">
                                                        <Label.FontSize>
                                                            <OnPlatform x:TypeArguments="x:Double">
                                                                <On Platform="Android" Value="11" />
                                                                <On Platform="iOS" Value="11" />
                                                                <On Platform="WinUI" Value="12" />
                                                            </OnPlatform>
                                                        </Label.FontSize>
                                                    </Label>
                                                </HorizontalStackLayout>
                                            </VerticalStackLayout>
                                        </VerticalStackLayout>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Bewerk / creÃ«er formulier - altijd zichtbaar zoals op Ledenpagina -->
                    <Border x:Name="EditForm" Stroke="#E1E1E1" StrokeThickness="1" BackgroundColor="White" StrokeShape="RoundRectangle 8" IsVisible="True">
                        <Border.Padding>
                            <OnPlatform x:TypeArguments="Thickness">
                                <On Platform="Android" Value="10" />
                                <On Platform="iOS" Value="10" />
                                <On Platform="WinUI" Value="12" />
                            </OnPlatform>
                        </Border.Padding>
                        <VerticalStackLayout>
                            <VerticalStackLayout.Spacing>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="8" />
                                    <On Platform="iOS" Value="8" />
                                    <On Platform="WinUI" Value="12" />
                                </OnPlatform>
                            </VerticalStackLayout.Spacing>
                            <!-- Boek picker met expliciete styling - responsive -->
                            <Grid ColumnDefinitions="Auto,*" Margin="0,8,0,0">
                                <Label Grid.Column="0"
                                       Text="{Binding BookTitle}"
                                       FontSize="14"
                                       TextColor="#5A5A5A"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center"
                                       MinimumWidthRequest="90"
                                       Padding="0,0,8,0" />
                                <Picker Grid.Column="1"
                                        x:Name="BoekPicker"
                                        ItemsSource="{Binding BoekenList}"
                                        ItemDisplayBinding="{Binding Titel}"
                                        SelectedItem="{Binding SelectedBoek}"
                                        Title="Selecteer boek"
                                        BackgroundColor="#F5F5F5"
                                        TextColor="#212121"
                                        TitleColor="#6E6E6E"
                                        HorizontalOptions="FillAndExpand"
                                        MinimumHeightRequest="44"
                                        HeightRequest="44"
                                        Margin="0,4">
                                    <Picker.FontSize>
                                        <OnPlatform x:TypeArguments="x:Double">
                                            <On Platform="Android" Value="14" />
                                            <On Platform="iOS" Value="14" />
                                            <On Platform="WinUI" Value="16" />
                                        </OnPlatform>
                                    </Picker.FontSize>
                                </Picker>
                            </Grid>
                            
                            <!-- Weergave geselecteerde boek details - responsive -->
                            <Frame BackgroundColor="#E8F5E9" IsVisible="{Binding SelectedBoek, Converter={StaticResource IsNotNullConverter}}">
                                <Frame.Padding>
                                    <OnPlatform x:TypeArguments="Thickness">
                                        <On Platform="Android" Value="6" />
                                        <On Platform="iOS" Value="6" />
                                        <On Platform="WinUI" Value="8" />
                                    </OnPlatform>
                                </Frame.Padding>
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="Geselecteerd boek:" TextColor="#2E7D32" FontAttributes="Bold">
                                        <Label.FontSize>
                                            <OnPlatform x:TypeArguments="x:Double">
                                                <On Platform="Android" Value="10" />
                                                <On Platform="iOS" Value="10" />
                                                <On Platform="WinUI" Value="11" />
                                            </OnPlatform>
                                        </Label.FontSize>
                                    </Label>
                                    <Label Text="{Binding SelectedBoek.Titel}" TextColor="#212121" FontAttributes="Bold">
                                        <Label.FontSize>
                                            <OnPlatform x:TypeArguments="x:Double">
                                                <On Platform="Android" Value="12" />
                                                <On Platform="iOS" Value="12" />
                                                <On Platform="WinUI" Value="13" />
                                            </OnPlatform>
                                        </Label.FontSize>
                                    </Label>
                                    <Label TextColor="#5A5A5A">
                                        <Label.FontSize>
                                            <OnPlatform x:TypeArguments="x:Double">
                                                <On Platform="Android" Value="10" />
                                                <On Platform="iOS" Value="10" />
                                                <On Platform="WinUI" Value="11" />
                                            </OnPlatform>
                                        </Label.FontSize>
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="Auteur: " />
                                                <Span Text="{Binding SelectedBoek.Auteur}" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                    <Label TextColor="#5A5A5A">
                                        <Label.FontSize>
                                            <OnPlatform x:TypeArguments="x:Double">
                                                <On Platform="Android" Value="10" />
                                                <On Platform="iOS" Value="10" />
                                                <On Platform="WinUI" Value="11" />
                                            </OnPlatform>
                                        </Label.FontSize>
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="ISBN: " />
                                                <Span Text="{Binding SelectedBoek.Isbn}" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                </VerticalStackLayout>
                            </Frame>

                            <!-- Lid picker met expliciete styling - responsive -->
                            <Grid ColumnDefinitions="Auto,*" Margin="0,8,0,0">
                                <Label Grid.Column="0"
                                       Text="{Binding MemberTitle}"
                                       FontSize="14"
                                       TextColor="#5A5A5A"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center"
                                       MinimumWidthRequest="90"
                                       Padding="0,0,8,0" />
                                <Picker Grid.Column="1"
                                        x:Name="LidPicker"
                                        ItemsSource="{Binding LedenList}"
                                        ItemDisplayBinding="{Binding FullName}"
                                        SelectedItem="{Binding SelectedLid}"
                                        Title="Selecteer lid"
                                        BackgroundColor="#F5F5F5"
                                        TextColor="#212121"
                                        TitleColor="#6E6E6E"
                                        HorizontalOptions="FillAndExpand"
                                        MinimumHeightRequest="44"
                                        HeightRequest="44"
                                        Margin="0,4">
                                    <Picker.FontSize>
                                        <OnPlatform x:TypeArguments="x:Double">
                                            <On Platform="Android" Value="14" />
                                            <On Platform="iOS" Value="14" />
                                            <On Platform="WinUI" Value="16" />
                                        </OnPlatform>
                                    </Picker.FontSize>
                                </Picker>
                            </Grid>
                            
                            <!-- Weergave geselecteerde lid details - responsive -->
                            <Frame BackgroundColor="#E3F2FD" IsVisible="{Binding SelectedLid, Converter={StaticResource IsNotNullConverter}}">
                                <Frame.Padding>
                                    <OnPlatform x:TypeArguments="Thickness">
                                        <On Platform="Android" Value="6" />
                                        <On Platform="iOS" Value="6" />
                                        <On Platform="WinUI" Value="8" />
                                    </OnPlatform>
                                </Frame.Padding>
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="Geselecteerd lid:" TextColor="#1565C0" FontAttributes="Bold">
                                        <Label.FontSize>
                                            <OnPlatform x:TypeArguments="x:Double">
                                                <On Platform="Android" Value="10" />
                                                <On Platform="iOS" Value="10" />
                                                <On Platform="WinUI" Value="11" />
                                            </OnPlatform>
                                        </Label.FontSize>
                                    </Label>
                                    <Label TextColor="#212121" FontAttributes="Bold">
                                        <Label.FontSize>
                                            <OnPlatform x:TypeArguments="x:Double">
                                                <On Platform="Android" Value="12" />
                                                <On Platform="iOS" Value="12" />
                                                <On Platform="WinUI" Value="13" />
                                            </OnPlatform>
                                        </Label.FontSize>
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="{Binding SelectedLid.Voornaam}" />
                                                <Span Text=" " />
                                                <Span Text="{Binding SelectedLid.AchterNaam}" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                    <Label Text="{Binding SelectedLid.Email}" TextColor="#5A5A5A">
                                        <Label.FontSize>
                                            <OnPlatform x:TypeArguments="x:Double">
                                                <On Platform="Android" Value="10" />
                                                <On Platform="iOS" Value="10" />
                                                <On Platform="WinUI" Value="11" />
                                            </OnPlatform>
                                        </Label.FontSize>
                                    </Label>
                                    <Label Text="{Binding SelectedLid.Telefoon}" TextColor="#5A5A5A" IsVisible="{Binding SelectedLid.Telefoon, Converter={StaticResource StringNotEmptyToBoolConverter}}">
                                        <Label.FontSize>
                                            <OnPlatform x:TypeArguments="x:Double">
                                                <On Platform="Android" Value="10" />
                                                <On Platform="iOS" Value="10" />
                                                <On Platform="WinUI" Value="11" />
                                            </OnPlatform>
                                        </Label.FontSize>
                                    </Label>
                                </VerticalStackLayout>
                            </Frame>

                            <!-- Start datum met expliciete styling - responsive -->
                            <Label Text="{Binding StartLabel}" TextColor="#5A5A5A" FontAttributes="Bold">
                                <Label.FontSize>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="14" />
                                        <On Platform="iOS" Value="14" />
                                        <On Platform="WinUI" Value="15" />
                                    </OnPlatform>
                                </Label.FontSize>
                            </Label>
                            <DatePicker x:Name="StartDatePicker" 
                                        Date="{Binding StartDate}"
                                        BackgroundColor="#F5F5F5"
                                        TextColor="#212121"
                                        Format="dd-MM-yyyy">
                                <DatePicker.HeightRequest>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="42" />
                                        <On Platform="iOS" Value="42" />
                                        <On Platform="WinUI" Value="50" />
                                    </OnPlatform>
                                </DatePicker.HeightRequest>
                                <DatePicker.FontSize>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="14" />
                                        <On Platform="iOS" Value="14" />
                                        <On Platform="WinUI" Value="16" />
                                    </OnPlatform>
                                </DatePicker.FontSize>
                            </DatePicker>

                            <!-- Einddatum met expliciete styling - responsive -->
                            <Label Text="{Binding DueLabel}" TextColor="#5A5A5A" FontAttributes="Bold">
                                <Label.FontSize>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="14" />
                                        <On Platform="iOS" Value="14" />
                                        <On Platform="WinUI" Value="15" />
                                    </OnPlatform>
                                </Label.FontSize>
                            </Label>
                            <DatePicker x:Name="DueDatePicker" 
                                        Date="{Binding DueDate}"
                                        BackgroundColor="#F5F5F5"
                                        TextColor="#212121"
                                        Format="dd-MM-yyyy">
                                <DatePicker.HeightRequest>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="42" />
                                        <On Platform="iOS" Value="42" />
                                        <On Platform="WinUI" Value="50" />
                                    </OnPlatform>
                                </DatePicker.HeightRequest>
                                <DatePicker.FontSize>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="14" />
                                        <On Platform="iOS" Value="14" />
                                        <On Platform="WinUI" Value="16" />
                                    </OnPlatform>
                                </DatePicker.FontSize>
                            </DatePicker>

                            <!-- Knoppen met proper styles - responsive -->
                            <VerticalStackLayout Margin="0,12,0,0">
                                <VerticalStackLayout.Spacing>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="6" />
                                        <On Platform="iOS" Value="6" />
                                        <On Platform="WinUI" Value="8" />
                                    </OnPlatform>
                                </VerticalStackLayout.Spacing>
                                
                                <Button Text="{Binding DeleteButtonText}" 
                                        Command="{Binding VerwijderCommand}" 
                                        Style="{StaticResource DangerButton}"
                                        HorizontalOptions="FillAndExpand">
                                    <Button.HeightRequest>
                                        <OnPlatform x:TypeArguments="x:Double">
                                            <On Platform="Android" Value="42" />
                                            <On Platform="iOS" Value="42" />
                                            <On Platform="WinUI" Value="48" />
                                        </OnPlatform>
                                    </Button.HeightRequest>
                                </Button>
                                <Button Text="{Binding SaveButtonText}" 
                                        Command="{Binding OpslaanCommand}" 
                                        Style="{StaticResource PrimaryButton}"
                                        HorizontalOptions="FillAndExpand">
                                    <Button.HeightRequest>
                                        <OnPlatform x:TypeArguments="x:Double">
                                            <On Platform="Android" Value="42" />
                                            <On Platform="iOS" Value="42" />
                                            <On Platform="WinUI" Value="48" />
                                        </OnPlatform>
                                    </Button.HeightRequest>
                                </Button>
                                </VerticalStackLayout>
                            </VerticalStackLayout>
                        </Border>
                    </VerticalStackLayout>
                </Frame>

                <!-- Desktop-friendly action bar for new/save/delete -->
                <HorizontalStackLayout Margin="0,8,0,0" HorizontalOptions="End">
                    <HorizontalStackLayout.Spacing>
                        <OnPlatform x:TypeArguments="x:Double">
                            <On Platform="Android" Value="8" />
                            <On Platform="iOS" Value="8" />
                            <On Platform="WinUI" Value="10" />
                        </OnPlatform>
                    </HorizontalStackLayout.Spacing>
                    <Button Text="Nieuw" Command="{Binding NieuwUitleningCommand}" />
                    <Button Text="Opslaan" Command="{Binding OpslaanUitleningCommand}" />
                    <Button Text="Verwijder" Command="{Binding VerwijderGeselecteerdeCommand}" />
                </HorizontalStackLayout>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
