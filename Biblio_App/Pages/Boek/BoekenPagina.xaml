<?xml version="1.0" encoding="utf-8" ?>
<?xaml-comp compile="true" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:Biblio_App.ViewModels"
             xmlns:models="clr-namespace:Biblio_Models.Entiteiten;assembly=Biblio_Models"
             x:Class="Biblio_App.Pages.BoekenPagina"
             x:DataType="viewmodel:BoekenViewModel"
             Title="{Binding PageTitle}"
             x:Name="Page"
             BackgroundColor="White">

    <!-- Use standard Title instead of TitleView to avoid Android threading issues -->
    
    <!-- Gebruik Grid layout direct zonder ScrollView om CollectionView scrolling te laten werken (Cross-platform layout) -->
    <Grid BackgroundColor="White">
        <Grid.Padding>
            <OnPlatform x:TypeArguments="Thickness">
                <On Platform="Android" Value="12,12,12,8" />
                <On Platform="iOS" Value="12,12,12,8" />
                <On Platform="WinUI" Value="12" />
            </OnPlatform>
        </Grid.Padding>
        <!-- Rijen: 0 = zoek/filter, 1 = lijst (header + CollectionView), 2 = paginering + lijn, 3 = formulier -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        
        <!-- Header / zoek rij met styled components - compacter op mobile -->
        <VerticalStackLayout Grid.Row="0" Spacing="10">
            <SearchBar Placeholder="{Binding SearchPlaceholder}" 
                       Text="{Binding SearchText}"
                       Style="{StaticResource SearchEntry}"
                       BackgroundColor="#F5F5F5"
                       HeightRequest="48"
                       FontSize="16" />
            
            <Button Text="{Binding SearchButtonText}" 
                    Command="{Binding ZoekCommand}" 
                    Style="{StaticResource FilterButton}"
                    HorizontalOptions="FillAndExpand"
                    HeightRequest="44"
                    FontSize="16" />
            
            <Picker Title="{Binding CategoryTitle}" 
                    ItemsSource="{Binding Categorien}" 
                    ItemDisplayBinding="{Binding Naam}" 
                    SelectedItem="{Binding SelectedFilterCategorie}" 
                    HorizontalOptions="FillAndExpand"
                    BackgroundColor="#F5F5F5" 
                    TextColor="#212121" 
                    TitleColor="#6E6E6E"
                    MinimumHeightRequest="44"
                    HeightRequest="44"
                    FontSize="16"
                    Margin="0,4"
                    HorizontalTextAlignment="Start">
                <Picker.MinimumWidthRequest>
                    <OnPlatform x:TypeArguments="x:Double">
                        <On Platform="Android" Value="0" />
                        <On Platform="iOS" Value="0" />
                        <On Platform="WinUI" Value="260" />
                    </OnPlatform>
                </Picker.MinimumWidthRequest>
                
                <Picker.FontSize>
                    <OnPlatform x:TypeArguments="x:Double">
                        <On Platform="Android" Value="16" />
                        <On Platform="iOS" Value="16" />
                        <On Platform="WinUI" Value="18" />
                    </OnPlatform>
                </Picker.FontSize>
            </Picker>
        </VerticalStackLayout>

        <!-- CollectionView: simple mobile-first layout -->
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding Boeken}" 
                        SelectionMode="None"
                        BackgroundColor="White">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Boek">
                    <SwipeView>
                        <!-- Swipe-to-delete (links) -->
                        <SwipeView.LeftItems>
                            <SwipeItems Mode="Execute">
                                <SwipeItem Text="Delete"
                                           BackgroundColor="#D32F2F"
                                           Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:BoekenViewModel}}, Path=ItemDeleteCommand}"
                                           CommandParameter="{Binding .}" />
                            </SwipeItems>
                        </SwipeView.LeftItems>
                        
                        <!-- Main content: tap to edit -->
                        <Border Stroke="#E0E0E0" 
                                StrokeThickness="1" 
                                BackgroundColor="White"
                                StrokeShape="RoundRectangle 8"
                                Padding="16,12"
                                Margin="0,4">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:BoekenViewModel}}, Path=ItemEditCommand}"
                                                      CommandParameter="{Binding .}" />
                            </Border.GestureRecognizers>
                            
                            <VerticalStackLayout Spacing="4">
                                <!-- Titel (prominent) -->
                                <Label Text="{Binding Titel}" 
                                       TextColor="#212121" 
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       LineBreakMode="TailTruncation" 
                                       MaxLines="2" />
                                
                                <!-- Auteur -->
                                <HorizontalStackLayout Spacing="6">
                                    <Label Text="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:BoekenViewModel}}, Path=HeaderAuthor}" 
                                           TextColor="#757575" 
                                           FontSize="14" />
                                    <Label Text="{Binding Auteur}" 
                                           TextColor="#424242" 
                                           FontSize="14"
                                           LineBreakMode="TailTruncation" />
                                </HorizontalStackLayout>
                                
                                <!-- Category -->
                                <HorizontalStackLayout Spacing="6">
                                    <Label Text="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:BoekenViewModel}}, Path=CategoryTitle}" 
                                           TextColor="#757575" 
                                           FontSize="14" />
                                    <Label Text="{Binding CategorieNaam}" 
                                           TextColor="#424242" 
                                           FontSize="14" />
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Border>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Paginering met hardcoded pijltjes -->
        <Grid Grid.Row="2" HorizontalOptions="Center" ColumnDefinitions="Auto,*,Auto" Padding="0,8,0,8">
            <Grid.ColumnSpacing>
                <OnPlatform x:TypeArguments="x:Double">
                    <On Platform="Android" Value="12" />
                    <On Platform="iOS" Value="12" />
                    <On Platform="WinUI" Value="16" />
                </OnPlatform>
            </Grid.ColumnSpacing>
            
            <!-- PREV knop met < symbool -->
            <Button Grid.Column="0" 
                    Text="&lt;" 
                    Command="{Binding PrevPageCommand}" 
                    BackgroundColor="#34495e"
                    TextColor="White"
                    CornerRadius="8"
                    FontSize="20"
                    FontAttributes="Bold"
                    WidthRequest="80"
                    HeightRequest="40" />

            <!-- Page indicator -->
            <Label Grid.Column="1"
                   Text="{Binding PageDisplay}" 
                   FontAttributes="Bold" 
                   VerticalOptions="Center" 
                   HorizontalOptions="Center" 
                   TextColor="#212121"
                   FontSize="16"
                   Padding="16,0"
                   MinimumWidthRequest="120"
                   HorizontalTextAlignment="Center" />

            <!-- NEXT knop met > symbool -->
            <Button Grid.Column="2" 
                    Text="&gt;" 
                    Command="{Binding NextPageCommand}" 
                    BackgroundColor="#34495e"
                    TextColor="White"
                    CornerRadius="8"
                    FontSize="20"
                    FontAttributes="Bold"
                    WidthRequest="80"
                    HeightRequest="40" />
        </Grid>

        <!-- Bewerk/toevoeg formulier onder collectie in ScrollView voor mobile -->
        <ScrollView Grid.Row="3">
            <VerticalStackLayout Padding="0,8,0,12">
                <VerticalStackLayout.Spacing>
                    <OnPlatform x:TypeArguments="x:Double">
                        <On Platform="Android" Value="8" />
                        <On Platform="iOS" Value="8" />
                        <On Platform="WinUI" Value="12" />
                    </OnPlatform>
                </VerticalStackLayout.Spacing>
                
                <!-- actie overzicht tekst boven het formulier -->
                <Label Text="{Binding OverviewText}" 
                       HorizontalOptions="Fill" 
                       HorizontalTextAlignment="Center" 
                       TextColor="{StaticResource Primary}"
                       FontAttributes="Bold">
                    <Label.FontSize>
                        <OnPlatform x:TypeArguments="x:Double">
                            <On Platform="Android" Value="13" />
                            <On Platform="iOS" Value="13" />
                            <On Platform="WinUI" Value="14" />
                        </OnPlatform>
                    </Label.FontSize>
                    <Label.Margin>
                        <OnPlatform x:TypeArguments="Thickness">
                            <On Platform="Android" Value="0,8,0,6" />
                            <On Platform="iOS" Value="0,8,0,6" />
                            <On Platform="WinUI" Value="0,12,0,8" />
                        </OnPlatform>
                    </Label.Margin>
                </Label>

                <Border Stroke="{StaticResource Gray100}" StrokeThickness="1" StrokeShape="RoundRectangle 8">
                    <Border.Padding>
                        <OnPlatform x:TypeArguments="Thickness">
                            <On Platform="Android" Value="10" />
                            <On Platform="iOS" Value="10" />
                            <On Platform="WinUI" Value="12" />
                        </OnPlatform>
                    </Border.Padding>
                    
                    <VerticalStackLayout>
                        <VerticalStackLayout.Spacing>
                            <OnPlatform x:TypeArguments="x:Double">
                                <On Platform="Android" Value="8" />
                                <On Platform="iOS" Value="8" />
                                <On Platform="WinUI" Value="12" />
                            </OnPlatform>
                        </VerticalStackLayout.Spacing>
                        
                        <Entry x:Name="TitelEntry" 
                               Placeholder="{Binding HeaderTitle}" 
                               Text="{Binding Titel, Mode=TwoWay}" 
                               BackgroundColor="White" 
                               TextColor="{StaticResource Gray900}" 
                               PlaceholderColor="{StaticResource Gray500}">
                            <Entry.HeightRequest>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="42" />
                                    <On Platform="iOS" Value="42" />
                                    <On Platform="WinUI" Value="50" />
                                </OnPlatform>
                            </Entry.HeightRequest>
                            <Entry.FontSize>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="14" />
                                    <On Platform="iOS" Value="14" />
                                    <On Platform="WinUI" Value="16" />
                                </OnPlatform>
                            </Entry.FontSize>
                        </Entry>
                        
                        <Entry x:Name="AuteurEntry" 
                               Placeholder="{Binding HeaderAuthor}" 
                               Text="{Binding Auteur, Mode=TwoWay}" 
                               BackgroundColor="White" 
                               TextColor="{StaticResource Gray900}" 
                               PlaceholderColor="{StaticResource Gray500}">
                            <Entry.HeightRequest>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="42" />
                                    <On Platform="iOS" Value="42" />
                                    <On Platform="WinUI" Value="50" />
                                </OnPlatform>
                            </Entry.HeightRequest>
                            <Entry.FontSize>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="14" />
                                    <On Platform="iOS" Value="14" />
                                    <On Platform="WinUI" Value="16" />
                                </OnPlatform>
                            </Entry.FontSize>
                        </Entry>
                        
                        <Entry x:Name="IsbnEntry" 
                               Placeholder="{Binding IsbnPlaceholder}" 
                               Text="{Binding Isbn, Mode=TwoWay}" 
                               BackgroundColor="White" 
                               TextColor="{StaticResource Gray900}" 
                               PlaceholderColor="{StaticResource Gray500}">
                            <Entry.HeightRequest>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="42" />
                                    <On Platform="iOS" Value="42" />
                                    <On Platform="WinUI" Value="50" />
                                </OnPlatform>
                            </Entry.HeightRequest>
                            <Entry.FontSize>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="14" />
                                    <On Platform="iOS" Value="14" />
                                    <On Platform="WinUI" Value="16" />
                                </OnPlatform>
                            </Entry.FontSize>
                        </Entry>

                        <Picker x:Name="EditCategoriePicker" 
                                Title="{Binding CategoryTitle}" 
                                ItemsSource="{Binding Categorien}" 
                                ItemDisplayBinding="{Binding Naam}" 
                                SelectedItem="{Binding SelectedCategory, Mode=TwoWay}" 
                                HorizontalTextAlignment="Start" 
                                BackgroundColor="White" 
                                TextColor="{StaticResource Gray900}">
                            <Picker.MinimumHeightRequest>44</Picker.MinimumHeightRequest>
                            <Picker.HeightRequest>44</Picker.HeightRequest>
                            <Picker.Margin>0,4</Picker.Margin>
                            <Picker.FontSize>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="14" />
                                    <On Platform="iOS" Value="14" />
                                    <On Platform="WinUI" Value="16" />
                                </OnPlatform>
                            </Picker.FontSize>
                        </Picker>

                        <VerticalStackLayout Margin="0,8,0,0">
                            <VerticalStackLayout.Spacing>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="Android" Value="6" />
                                    <On Platform="iOS" Value="6" />
                                    <On Platform="WinUI" Value="8" />
                                </OnPlatform>
                            </VerticalStackLayout.Spacing>
                            
                            <Button Text="{Binding NewButtonText}" 
                                    Command="{Binding NieuwCommand}" 
                                    Style="{StaticResource OutlineActionButton}"
                                    HorizontalOptions="FillAndExpand">
                                <Button.HeightRequest>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="38" />
                                        <On Platform="iOS" Value="38" />
                                        <On Platform="WinUI" Value="45" />
                                    </OnPlatform>
                                </Button.HeightRequest>
                            </Button>
                            
                            <Button Text="{Binding DeleteButtonText}" 
                                    Command="{Binding VerwijderCommand}" 
                                    Style="{StaticResource DangerButton}"
                                    HorizontalOptions="FillAndExpand">
                                <Button.HeightRequest>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="38" />
                                        <On Platform="iOS" Value="38" />
                                        <On Platform="WinUI" Value="45" />
                                    </OnPlatform>
                                </Button.HeightRequest>
                            </Button>
                            
                            <Button Text="{Binding SaveButtonText}" 
                                    Command="{Binding OpslaanCommand}" 
                                    Style="{StaticResource PrimaryButton}"
                                    HorizontalOptions="FillAndExpand">
                                <Button.HeightRequest>
                                    <OnPlatform x:TypeArguments="x:Double">
                                        <On Platform="Android" Value="38" />
                                        <On Platform="iOS" Value="38" />
                                        <On Platform="WinUI" Value="45" />
                                    </OnPlatform>
                                </Button.HeightRequest>
                            </Button>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>