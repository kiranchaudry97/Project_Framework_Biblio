<?xml version="1.0" encoding="utf-8" ?>
<?xaml-comp compile="true" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:Biblio_App.ViewModels"
             xmlns:models="clr-namespace:Biblio_Models.Entiteiten;assembly=Biblio_Models"
             x:Class="Biblio_App.Pages.BoekenPagina"
             x:DataType="viewmodel:BoekenViewModel"
             Title="{Binding PageTitle}"
             x:Name="Page"
             BackgroundColor="White">

    <Shell.TitleView>
        <Grid Padding="0,0,8,0" VerticalOptions="Center" BackgroundColor="{StaticResource Primary}">
            <!-- genaamd TitleLabel zodat code-behind de weergegeven titel geforceerd kan updaten wanneer de taal wijzigt -->
            <Label x:Name="TitleLabel" Text="{Binding PageTitle}" FontSize="22" FontAttributes="Bold" VerticalOptions="Center" TextColor="White" />
        </Grid>
    </Shell.TitleView>

    <!-- Verpak in ScrollView voor responsiviteit -->
    <ScrollView>
        <!-- Gebruik Grid layout zodat CollectionView beschikbare ruimte ontvangt en virtualisatie correct werkt -->
        <Grid Padding="12" RowDefinitions="Auto,Auto,Auto,Auto" BackgroundColor="White">
            <!-- Header / zoek rij -->
            <VerticalStackLayout Grid.Row="0" Spacing="8">
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                    <SearchBar Grid.Column="0" Placeholder="{Binding SearchPlaceholder}" Text="{Binding SearchText}"
                               BackgroundColor="#F5F5F5" TextColor="#212121" PlaceholderColor="#6E6E6E" />
                    <Button Grid.Column="1" Text="{Binding SearchButtonText}" Command="{Binding ZoekCommand}" 
                            BackgroundColor="{StaticResource Primary}" TextColor="White" 
                            WidthRequest="80" />
                </Grid>
                <Picker Title="{Binding CategoryTitle}" ItemsSource="{Binding Categorien}" 
                        ItemDisplayBinding="{Binding Naam}" SelectedItem="{Binding SelectedFilterCategorie}" 
                        HorizontalOptions="FillAndExpand" MinimumWidthRequest="150" MaximumWidthRequest="300"
                        BackgroundColor="#F5F5F5" TextColor="#212121" TitleColor="#6E6E6E" />
        </VerticalStackLayout>

        <!-- Spacer -->
        <BoxView Grid.Row="1" HeightRequest="8" BackgroundColor="Transparent" />

        <!-- CollectionView: beperkte hoogte zodat het niet te veel ruimte inneemt op kleine schermen -->
        <Frame Grid.Row="2" Style="{StaticResource WelcomeCardStyle}" BackgroundColor="White" HeightRequest="400" MaximumHeightRequest="600">
            <Grid RowDefinitions="Auto,*,Auto,Auto" BackgroundColor="White">
                <CollectionView ItemsSource="{Binding Boeken}" SelectionMode="Single" SelectedItem="{Binding SelectedBoek, Mode=TwoWay}" Grid.Row="1" BackgroundColor="White">
                    <CollectionView.Header>
                        <Grid ColumnDefinitions="2*,2*,Auto" ColumnSpacing="8" Padding="8" BackgroundColor="#F5F5F5">
                            <Label Text="{Binding HeaderTitle}" Grid.Column="0" FontAttributes="Bold" TextColor="#212121" FontSize="12" />
                            <Label Text="{Binding HeaderAuthor}" Grid.Column="1" FontAttributes="Bold" TextColor="#212121" FontSize="12" />
                            <Label Text="{Binding CategoryTitle}" Grid.Column="2" FontAttributes="Bold" TextColor="#212121" HorizontalOptions="End" FontSize="12" />
                        </Grid>
                    </CollectionView.Header>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Boek">
                            <Grid ColumnDefinitions="2*,2*,Auto" ColumnSpacing="8" Padding="6" Margin="0,2" VerticalOptions="Center" BackgroundColor="White">
                                <Label Text="{Binding Titel}" Grid.Column="0" TextColor="#212121" LineBreakMode="TailTruncation" MaxLines="1" FontSize="12">
                                    <Label.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnLabelTapped" NumberOfTapsRequired="1" />
                                    </Label.GestureRecognizers>
                                </Label>

                                <Label Text="{Binding Auteur}" Grid.Column="1" TextColor="#212121" LineBreakMode="TailTruncation" MaxLines="1" FontSize="12">
                                    <Label.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnLabelTapped" NumberOfTapsRequired="1" />
                                    </Label.GestureRecognizers>
                                </Label>

                                <!-- Toon categorie naam voor het boek -->
                                <Label Grid.Column="2" Text="{Binding CategorieNaam}" TextColor="#212121" VerticalOptions="Center" HorizontalOptions="End" FontSize="12" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Paginering besturing -->
                <Grid Grid.Row="2" HorizontalOptions="Center" Margin="8" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="24" BackgroundColor="White">
                    <Button Grid.Column="0" Text="{Binding PrevButtonText}" Command="{Binding PrevPageCommand}" Style="{StaticResource PrimaryButton}" WidthRequest="56" HeightRequest="40" />

                    <HorizontalStackLayout Grid.Column="1" HorizontalOptions="Center" VerticalOptions="Center">
                        <Frame Padding="8,6" HasShadow="False" CornerRadius="10" BackgroundColor="Transparent" HorizontalOptions="Center" VerticalOptions="Center">
                            <Label Text="{Binding PageDisplay}" FontAttributes="Bold" VerticalOptions="Center" HorizontalOptions="Center" TextColor="#212121" FontSize="18" />
                        </Frame>
                    </HorizontalStackLayout>

                    <Button Grid.Column="2" Text="{Binding NextButtonText}" Command="{Binding NextPageCommand}" Style="{StaticResource PrimaryButton}" WidthRequest="56" HeightRequest="40" />
                </Grid>

                <BoxView Grid.Row="3" HeightRequest="1" Color="#E1E1E1" />
            </Grid>
        </Frame>

        <!-- Bewerk/toevoeg formulier onder collectie -->
        <VerticalStackLayout Grid.Row="3" Spacing="8">
            <!-- actie overzicht tekst boven het formulier (iets lager geplaatst) -->
            <Label Text="{Binding OverviewText}" HorizontalOptions="Fill" HorizontalTextAlignment="Center" TextColor="{StaticResource Primary}"
                   FontAttributes="Bold" FontSize="14" Margin="0,18,0,6" />

            <!-- breadcrumb / actie overzicht tekst, gecentreerd en uitgelijnd -->
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="12" Padding="0,0,0,6">
                <Label Text="Overzicht" TextColor="#5A5A5A" FontAttributes="Bold" />
                <Label Text="-" TextColor="#919191" />
                <Label Text="Details" TextColor="#5A5A5A" />
                <Label Text="-" TextColor="#919191" />
                <Label Text="Bewerk" TextColor="{StaticResource Gray700}" />
                <Label Text="-" TextColor="{StaticResource Gray400}" />
                <Label Text="Verwijder" TextColor="{StaticResource Gray700}" />
            </HorizontalStackLayout>

            <Border Stroke="{StaticResource Gray100}" StrokeThickness="1" Padding="10">
                <VerticalStackLayout Spacing="8">
                    <Entry x:Name="TitelEntry" Placeholder="{Binding HeaderTitle}" Text="{Binding Titel, Mode=TwoWay}" BackgroundColor="White" TextColor="{StaticResource Gray900}" PlaceholderColor="{StaticResource Gray500}" />
                    <Entry x:Name="AuteurEntry" Placeholder="{Binding HeaderAuthor}" Text="{Binding Auteur, Mode=TwoWay}" BackgroundColor="White" TextColor="{StaticResource Gray900}" PlaceholderColor="{StaticResource Gray500}" />
                    <Entry x:Name="IsbnEntry" Placeholder="{Binding IsbnPlaceholder}" Text="{Binding Isbn, Mode=TwoWay}" BackgroundColor="White" TextColor="{StaticResource Gray900}" PlaceholderColor="{StaticResource Gray500}" />

                    <Picker x:Name="EditCategoriePicker" Title="{Binding CategoryTitle}" ItemsSource="{Binding Categorien}" ItemDisplayBinding="{Binding Naam}" SelectedItem="{Binding SelectedCategory, Mode=TwoWay}" HorizontalTextAlignment="Start" BackgroundColor="White" TextColor="{StaticResource Gray900}" />

                    <HorizontalStackLayout Spacing="12" HorizontalOptions="End">
                        <Button Text="{Binding NewButtonText}" Command="{Binding NieuwCommand}" Style="{StaticResource OutlineActionButton}" />
                        <!-- Re-added Delete button bound to VerwijderCommand -->
                        <Button Text="{Binding DeleteButtonText}" Command="{Binding VerwijderCommand}" BackgroundColor="Crimson" TextColor="White" />
                        <Button Text="{Binding SaveButtonText}" Command="{Binding OpslaanCommand}" Style="{StaticResource PrimaryButton}" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Border>
        </VerticalStackLayout>
    </Grid>
    </ScrollView>
</ContentPage>