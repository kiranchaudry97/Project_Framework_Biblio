<?xml version="1.0" encoding="utf-8" ?>
<?xaml-comp compile="true" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:Biblio_App.ViewModels"
             x:Class="Biblio_App.Pages.InstellingenPagina"
             x:DataType="viewmodel:InstellingenViewModel"
             Title="Instellingen"
             x:Name="Page">

    <Shell.TitleView>
        <Grid Padding="0,0,8,0" VerticalOptions="Center">
            <Label x:Name="TitleLabel" Text="Instellingen" FontSize="22" FontAttributes="Bold" VerticalOptions="Center" TextColor="{StaticResource White}" />
        </Grid>
    </Shell.TitleView>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">
            <Label x:Name="HeaderLabel" Text="Instellingen" Style="{StaticResource PageHeaderLabel}" />

            <Frame Style="{StaticResource WelcomeCardStyle}" Padding="16">
                <VerticalStackLayout Spacing="16">
                    
                    <!-- Taal sectie -->
                    <VerticalStackLayout Spacing="8">
                        <Label x:Name="LanguageLabel" 
                               Text="Taal / Language / Langue" 
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="#212121" />
                        
                        <!-- Custom Picker Layout met duidelijke selected value -->
                        <Border Stroke="#1e3050" 
                                StrokeThickness="2"
                                BackgroundColor="White"
                                Padding="12,8"
                                StrokeShape="RoundRectangle 8"
                                MinimumHeightRequest="60">
                            <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,40" RowSpacing="4">
                                <!-- Title label -->
                                <Label Grid.Row="0" Grid.Column="0"
                                       Text="Geselecteerde taal"
                                       FontSize="12"
                                       TextColor="#5A5A5A"
                                       VerticalOptions="Start" />
                                
                                <!-- Selected value - prominently displayed -->
                                <Label Grid.Row="1" Grid.Column="0"
                                       Text="{Binding SelectedLanguage}"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="#212121"
                                       VerticalOptions="Center" />
                                
                                <!-- Dropdown pijl -->
                                <Label Grid.Row="0" Grid.RowSpan="2" Grid.Column="1"
                                       Text="â–¼"
                                       FontSize="18"
                                       TextColor="#1e3050"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                                
                                <!-- Invisible Picker overlay voor functionaliteit -->
                                <Picker Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Grid.ColumnSpan="2"
                                        x:Name="LanguagePicker" 
                                        ItemsSource="{Binding Languages}" 
                                        SelectedItem="{Binding SelectedLanguage}"
                                        BackgroundColor="Transparent"
                                        TextColor="Transparent"
                                        TitleColor="Transparent"
                                        Opacity="0.01"
                                        HorizontalOptions="FillAndExpand"
                                        VerticalOptions="FillAndExpand" />
                            </Grid>
                        </Border>
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="#C8C8C8" Margin="0,8" />

                    <!-- Synchronisatie sectie -->
                    <VerticalStackLayout Spacing="8">
                        <Label x:Name="SyncLabel" 
                               Text="Automatische synchronisatie" 
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="#212121" />
                        <HorizontalStackLayout Spacing="12" VerticalOptions="Center">
                            <Switch x:Name="AutoSyncSwitch" 
                                    IsToggled="{Binding AutoSync}" 
                                    VerticalOptions="Center" />
                            <Label Text="{Binding AutoSync, StringFormat='Auto sync: {0}'}" 
                                   VerticalOptions="Center"
                                   FontSize="14"
                                   TextColor="#404040" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>

                    <!-- Action buttons -->
                    <HorizontalStackLayout Spacing="12" HorizontalOptions="End" Margin="0,8,0,0">
                        <Button x:Name="SyncNowButton" 
                                Text="Synchroniseer nu" 
                                Command="{Binding SyncNowCommand}" 
                                BackgroundColor="#1e3050"
                                TextColor="White"
                                FontSize="14"
                                FontAttributes="Bold"
                                CornerRadius="8"
                                Padding="16,10"
                                MinimumWidthRequest="140"
                                HeightRequest="44"
                                IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}" />
                        <Button x:Name="CheckApiButton" 
                                Text="Controleer API" 
                                Command="{Binding CheckApiCommand}" 
                                BackgroundColor="Transparent"
                                TextColor="#1e3050"
                                BorderColor="#1e3050"
                                BorderWidth="2"
                                FontSize="14"
                                FontAttributes="Bold"
                                CornerRadius="8"
                                Padding="16,10"
                                MinimumWidthRequest="140"
                                HeightRequest="44" />
                    </HorizontalStackLayout>

                    <BoxView HeightRequest="1" Color="#C8C8C8" Margin="0,8" />

                    <!-- Status sectie -->
                    <VerticalStackLayout Spacing="8">
                        <Label x:Name="StatusLabel" 
                               Text="Status:" 
                               FontSize="15"
                               FontAttributes="Bold"
                               TextColor="#212121" />
                        <Label Text="{Binding StatusMessage}" 
                               FontSize="14"
                               TextColor="#5A5A5A"
                               LineBreakMode="WordWrap" />
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="#C8C8C8" Margin="0,8" />

                    <!-- Database sectie -->
                    <VerticalStackLayout Spacing="8">
                        <Label x:Name="DatabaseHeaderLabel" 
                               Text="Database informatie" 
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="#212121" />
                        <Label Text="{Binding DatabaseInfo}" 
                               FontSize="13"
                               LineBreakMode="WordWrap"
                               TextColor="#5A5A5A" />
                        
                        <!-- Database action buttons -->
                        <HorizontalStackLayout Spacing="12" Margin="0,12,0,0">
                            <Button x:Name="LoadDbButton" 
                                    Text="Laad database info" 
                                    Command="{Binding LoadDatabaseInfoCommand}"
                                    BackgroundColor="Transparent"
                                    TextColor="#1e3050"
                                    BorderColor="#1e3050"
                                    BorderWidth="2"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    CornerRadius="8"
                                    Padding="16,10"
                                    MinimumWidthRequest="160"
                                    HeightRequest="44" />
                            <Button x:Name="ResetDbButton" 
                                    Text="Reset lokale DB" 
                                    Clicked="OnResetDbClicked"
                                    BackgroundColor="#dc3545"
                                    TextColor="White"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    CornerRadius="8"
                                    Padding="16,10"
                                    MinimumWidthRequest="160"
                                    HeightRequest="44" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>

                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>